package ru.mail.polis.homework.processor;

/**
 * –ó–∞–¥–∞–Ω–∏–µ: –Ω–∞–ø–∏—Å–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞.
 * –ù–∞–¥–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 4 –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ç–µ–∫—Å—Ç–∞
 * 1) –°—Ö–ª–æ–ø—ã–≤–∞–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–¥—Å—Ç—Ä–æ–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ä–µ–≥—É–ª—è—Ä–Ω–æ–º—É –≤—ã—Ä–∞–∂–µ–Ω–∏—é \s+ –≤ –æ–¥–∏–Ω –ø—Ä–æ–±–µ–ª
 * 2) –ó–∞–º–µ–Ω–∞ –ø–µ—Ä–≤–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∑–∞–¥–∞–Ω–Ω–æ–º—É —Ä–µ–≥—É–ª—è—Ä–Ω–æ–º—É –≤—ã—Ä–∞–∂–µ–Ω–∏—é –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é –ø–æ–¥—Å—Ç—Ä–æ–∫—É
 * 3) –û–±—Ä–µ–∑–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –¥–æ –∑–∞–¥–∞–Ω–Ω–æ–π –¥–ª–∏–Ω—ã
 * 4) –ó–∞–º–µ–Ω–∞ –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ –∑–∞–≥–ª–∞–≤–Ω—ã–µ
 * –î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∂–µ –∏–º–µ—é—â–∏–µ—Å—è –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞ String
 * <p>
 * –ö–ª–∞—Å—Å TextProcessorManager —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ —Å–æ—Å—Ç–æ–∏—Ç –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º
 * –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫ —Ç–µ–∫—Å—Ç—É. –ï—Å–ª–∏ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –≤—Ö–æ–¥ –ø–æ–¥–∞–µ—Ç—Å—è null, —Ç–æ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è null.
 * <p>
 * –ö–∞–∂–¥—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –Ω–µ–∫–æ—Ç–æ—Ä–æ–π —Å—Ç–∞–¥–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏: –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥, –ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥, –ø–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥
 * (–ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å –∏—Ö –≤ ProcessingStage). –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–µ–π —Å—Ç–∞–¥–∏–∏ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
 * —Å –±–æ–ª–µ–µ –ø–æ–∑–¥–Ω–µ–π —Å—Ç–∞–¥–∏–∏ (–ø–æ—Ä—è–¥–æ–∫ —Å—Ç–∞–¥–∏–π –¥–∞–Ω –≤—ã—à–µ).
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å –æ–¥–Ω–æ–π —Å—Ç–∞–¥–∏–∏ –º–æ–≥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –¥—Ä—É–≥ –ø–æ—Å–ª–µ –¥—Ä—É–≥–∞, –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.
 * –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, –Ω–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —ç—Ç–æ–º—É —Å–≤–æ–π—Å—Ç–≤—É, —Ç–æ TextProcessorManager –Ω–µ –¥–æ–ª–∂–µ–Ω –Ω–∏—á–µ–≥–æ
 * –¥–µ–ª–∞—Ç—å —Å –∏—Å—Ö–æ–¥–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ.
 * <p>
 * –ß—Ç–æ–±—ã –Ω–µ —É—Å–ª–æ–∂–Ω—è—Ç—å –ª–æ–≥–∏–∫—É TextProcessorManager, –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä TextProcessorManager –≤–æ
 * –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–º –º–µ—Ç–æ–¥–µ construct. –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∑–∞–¥–∞–Ω–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏,
 * –∏ –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞, —Ç–æ –≤–µ—Ä–Ω–µ–º –∑–∞–≥–ª—É—à–∫—É, –∫–æ—Ç–æ—Ä–∞—è –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç. –?–Ω–∞—á–µ —Å–æ–∑–¥–∞–¥–∏–º —ç–∫–∑–µ–º–ø–ª—è—Ä —Å –ø–æ–º–æ—â—å—é –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ
 * –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –º—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π
 * –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤. –≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω —É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
 * –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥ isValidSequence) –∏ —ç–∫–∑–µ–º–ø–ª—è—Ä –∑–∞–≥–ª—É—à–∫–∏ (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª–µ EMPTY).
 * –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –º–µ—Ç–æ–¥ isValidSequence –Ω–µ –∏–º–µ–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –¥–æ—Å—Ç—É–ø–∞, –∏ —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –∫–æ–¥–µ
 * —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤ (—Ç.–∫. –æ–Ω–∏ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ —Ç–æ–º—É –∂–µ –ø–∞–∫–µ—Ç—É).
 *
 * –ë–∞–∑–æ–≤–∞—è –æ–±–≤—è–∑–∫–∞ –∫–ª–∞—Å—Å–∞ 2 –±–∞–ª–ª–∞ + 3 –±–∞–ª–ª–∞ –∑–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é. –?—Ç–æ–≥–æ 5
 * –°—É–º–º–∞—Ä–Ω–æ, –ø–æ –≤—Å–µ–º—É –∑–∞–¥–∞–Ω–∏—é 15 –±–∞–ª–ª–æ–≤
 */
public class TextProcessorManager {
    private static final TextProcessorManager EMPTY = new TextProcessorManager(new TextProcessor[0]);
    private final TextProcessor[] processors;

    private TextProcessorManager(TextProcessor[] processors) {
        this.processors = processors;
    }

    public String processText(String text) {
        if (text == null) {
            return null;
        }
        String textProcess = text;
        for (TextProcessor processor: processors) {
            textProcess = processor.processText(textProcess);
        }
        return textProcess;
    }

    public static TextProcessorManager construct(TextProcessor[] processors) {
        if (!isValidSequence(processors)) {
            return EMPTY;
        }
        return new TextProcessorManager(processors);
    }

    // visible for tests
    static boolean isValidSequence(TextProcessor[] processors) {
        for (int i = 0; i < processors.length - 1; i++) {
            if (processors[i].getStage().getStage() > processors[i + 1].getStage().getStage()) {
                return false;
            }
        }
        return true;
    }
}
